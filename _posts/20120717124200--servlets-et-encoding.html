---
layout: post
title: Servlets et encoding...
---
J'ai eu des petit soucis avec le charset...<br/><br/> Un svi envoyait bien "text/csv; charset=utf-8" (curl) mais pour une raison x ou y, mon ihm qui l'appelait voyait "text/plain;charset=ISO-8859-1" ce qui faisait que le fichier était mal affiché.<br/><br/> Dans le code ci-dessous, j'ouvre une connection et récupère le charset afin d'initialiser l'InputStreamReader et commencer les lectures...  <code><pre><br />        URL url = new URL(sviUrl);<br />        URLConnection conn = url.openConnection();  <br />        conn.connect();<br />        InputStream in = null;<br />        try {<br />            String charset = "ISO-8859-1";<br />            String contentType = conn.getContentType(); <br />            if (contentType != null && contentType.indexOf(";charset=") >= 0) {<br />                contentType = contentType.substring(contentType.indexOf(";charset=")+9);<br />                charset = contentType.trim();<br />            }<br />            in = conn.getInputStream();<br />            InputStreamReader inr = new InputStreamReader(url.openStream(), charset);<br />            Writer out = resp.getWriter();<br />            try {<br />                IOUtils.copy(inr, out);<br />            } finally {<br />                inr.close();<br />            }<br />        } finally {<br />            if (in != null) {<br />                in.close();<br />            }<br />        }<br /></pre></code>
